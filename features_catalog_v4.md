# 特征工程因子目录 v4.0 - 多周期标注版

基于OHLCV数据的分钟级经典因子库，明确标注多周期计算需求。

**符号约定：**
- O_t, H_t, L_t, C_t, V_t：第t期的开盘价、最高价、最低价、收盘价、成交量
- MA_n(X)：X的n期简单移动平均
- EMA_n(X)：X的n期指数移动平均，α = 2/(n+1)
- Std_n(X)：X的n期标准差
- Max_n(X)、Min_n(X)：X在n期内的最大值、最小值
- Σ：求和符号

**标注说明：**
- **[趋势]** - 趋势因子
- **[多周期-必须]** - 必须计算多个时间周期
- **[多周期-建议]** - 建议计算多个时间周期
- **[单周期]** - 单一周期即可

---

## 1. 流动性因子 (Liquidity Factors)

流动性因子衡量市场交易活跃度，帮助识别资金流向和市场参与度。

---

### 1.1 Volume_Ratio（成交量比率）**[多周期-必须]**

**作用：** 识别异常放量，确认突破有效性，判断市场关注度变化。放量突破更可靠，缩量运行需警惕。

**计算公式：**
```
Volume_Ratio_t = V_t / MA_n(V_t)
```

**参数：** n = 20

**多周期配置：**
- **5分钟**：瞬时异动识别
- **15分钟**：短期放量确认
- **30分钟**：重要突破确认 ⭐
- **60分钟**：大级别突破验证

**使用说明：**
- Volume_Ratio > 1.5：显著放量
- Volume_Ratio > 2.0：异常放量
- Volume_Ratio < 0.5：缩量
- 多周期同时放量 = 强烈信号

---

### 1.2 VWAP（成交量加权平均价）**[趋势] [单周期]**

**作用：** 反映市场平均成交成本，作为日内交易的重要支撑/阻力位，机构常用的执行基准。

**计算公式：**
```
TP_t = (H_t + L_t + C_t) / 3
VWAP_t = Σ(TP_i × V_i) / Σ(V_i),  i ∈ [开盘, t]
```

**多周期配置：**
- **日内VWAP**：从开盘累计（主要使用）
- **滚动60分钟VWAP**：可选，用于滚动窗口计算

**使用说明：**
- 价格在VWAP之上：日内强势
- 价格在VWAP之下：日内弱势
- 价格回踩VWAP不破：买入点
- VWAP通常不需要多周期，使用日内累计即可

---

### 1.3 VWAP_Distance（VWAP偏离度）**[单周期]**

**作用：** 衡量价格偏离平均成本的程度，识别超买超卖和均值回归机会。

**计算公式：**
```
VWAP_Distance_t = (C_t - VWAP_t) / VWAP_t × 100%
```

**使用说明：**
- |Distance| > 1%：显著偏离
- |Distance| > 2%：极端偏离
- 基于日内VWAP计算即可

---

### 1.4 OBV (On Balance Volume)（能量潮）**[趋势] [多周期-必须]**

**作用：** 累积成交量指标，判断资金流向，验证价格趋势真实性，发现背离信号。

**计算公式：**
```
OBV_t = OBV_{t-1} + V_t      if C_t > C_{t-1}
OBV_t = OBV_{t-1} - V_t      if C_t < C_{t-1}
OBV_t = OBV_{t-1}            if C_t = C_{t-1}
```

初始值：OBV_0 = 0

**多周期配置：**
- **15分钟**：短线资金流向
- **30分钟**：日内主要参考 ⭐
- **60分钟**：大趋势资金流

**使用说明：**
- OBV上升 + 价格上升：趋势健康
- OBV下降 + 价格上升：顶背离
- OBV上升 + 价格下降：底背离
- 多周期OBV趋势一致 = 强趋势确认

---

## 2. 波动性因子 (Volatility Factors)

波动性因子衡量价格波动幅度，用于风险管理、止损设置和识别市场状态。

---

### 2.1 ATR (Average True Range)（平均真实波幅）**[多周期-必须]**

**作用：** 最重要的波动率指标，用于动态止损、仓位管理、识别趋势强度。波动率是风控的核心。

**计算公式：**
```
TR_t = Max(H_t - L_t, |H_t - C_{t-1}|, |L_t - C_{t-1}|)
ATR_t = EMA_n(TR_t)
```

**参数：** n = 14

**多周期配置：**
- **5分钟**：超短线止损 ⭐
- **15分钟**：短线止损参考 ⭐
- **30分钟**：日内主要止损标准 ⭐⭐
- **60分钟**：隔夜持仓止损 ⭐⭐
- **120分钟**：跨日持仓风控

**使用说明：**
- 止损距离：2-3倍ATR
- ATR扩大：趋势启动或加速
- ATR缩小：震荡市，趋势可能结束
- 根据持仓时间选择对应周期的ATR

---

### 2.2 Bollinger_Bands（布林带）**[多周期-必须]**

**作用：** 识别超买超卖，判断波动率扩张/收缩，提供动态支撑阻力位。

**计算公式：**
```
BB_Middle_t = MA_n(C_t)
BB_Std_t = Std_n(C_t)
BB_Upper_t = BB_Middle_t + k × BB_Std_t
BB_Lower_t = BB_Middle_t - k × BB_Std_t

BB_Width_t = (BB_Upper_t - BB_Lower_t) / BB_Middle_t
%B_t = (C_t - BB_Lower_t) / (BB_Upper_t - BB_Lower_t)
```

**参数：** n = 20, k = 2

**多周期配置：**
- **15分钟**：短线超买超卖
- **30分钟**：日内主要通道 ⭐⭐
- **60分钟**：大级别通道和突破 ⭐

**使用说明：**
- %B > 1：突破上轨（超买或趋势启动）
- %B < 0：突破下轨（超卖或趋势启动）
- BB_Width收缩：蓄势待发
- BB_Width扩张：趋势启动

---

### 2.3 Historical_Volatility（历史波动率）**[多周期-建议]**

**作用：** 衡量价格波动的标准差，用于期权定价、风险预算、市场状态分类。

**计算公式：**
```
Return_t = ln(C_t / C_{t-1})
HV_t = Std_n(Return_t) × sqrt(252 × 1440/k) × 100%
```

其中k为K线周期（分钟），对于1分钟线：k=1

**参数：** n = 20

**多周期配置：**
- **30分钟**：日内波动率监控
- **60分钟**：主要参考周期 ⭐
- **120分钟**：宏观波动率评估

**使用说明：**
- HV < 20%：低波环境
- HV > 40%：高波环境
- HV突增：市场状态转变

---

## 3. 动量因子 (Momentum Factors)

动量因子捕捉价格运动的速度和方向，是趋势跟踪和反转策略的核心。

---

### 3.1 RSI (Relative Strength Index)（相对强弱指标）**[多周期-必须]**

**作用：** 最经典的超买超卖指标，识别反转时机，判断价格强弱，发现背离信号。

**计算公式：**
```
Up_t = Max(C_t - C_{t-1}, 0)
Down_t = Max(C_{t-1} - C_t, 0)

EMA_Up_t = EMA_n(Up_t)
EMA_Down_t = EMA_n(Down_t)

RS_t = EMA_Up_t / EMA_Down_t
RSI_t = 100 - 100 / (1 + RS_t)
```

**参数：** n = 14

**多周期配置：**
- **5分钟**：超短线超买超卖
- **15分钟**：日内短线信号 ⭐
- **30分钟**：日内主要参考 ⭐⭐
- **60分钟**：大级别超买超卖 ⭐

**使用说明：**
- RSI > 70：超买区
- RSI < 30：超卖区
- RSI > 80 或 < 20：极端区域
- 背离信号：价格与RSI方向不一致
- 多周期背离共振 = 强烈反转信号

---

### 3.2 MACD（异同移动平均线）**[趋势] [多周期-必须]**

**作用：** 最流行的趋势跟踪指标，判断趋势方向、强度和转折点，产生明确的买卖信号。

**计算公式：**
```
EMA_fast_t = EMA_12(C_t)
EMA_slow_t = EMA_26(C_t)

MACD_t = EMA_fast_t - EMA_slow_t
MACD_Signal_t = EMA_9(MACD_t)
MACD_Hist_t = MACD_t - MACD_Signal_t
```

**多周期配置：**
- **15分钟**：短线交易信号 ⭐
- **30分钟**：日内主要信号 ⭐⭐
- **60分钟**：日内趋势判断 ⭐⭐
- **120分钟**：大趋势背景

**使用说明：**
- 金叉：MACD上穿Signal线（买入）
- 死叉：MACD下穿Signal线（卖出）
- Histogram > 0 且扩大：上涨动能增强
- Histogram收敛：动能衰减
- MACD > 0：中期多头市场
- 多周期金叉共振 = 强烈买入信号

---

### 3.3 Stochastic（随机指标）**[多周期-建议]**

**作用：** 衡量价格在N期范围内的相对位置，敏感的超买超卖指标，适合震荡市。

**计算公式：**
```
Lowest_Low_n = Min_n(L_t)
Highest_High_n = Max_n(H_t)

%K_t = (C_t - Lowest_Low_n) / (Highest_High_n - Lowest_Low_n) × 100
%D_t = MA_3(%K_t)
```

**参数：** n = 14, m = 3

**多周期配置：**
- **5分钟**：超短线信号
- **15分钟**：短线参考 ⭐
- **30分钟**：日内震荡参考

**使用说明：**
- %K > 80：超买
- %K < 20：超卖
- %K上穿%D：买入信号
- 适合短周期，长周期建议用RSI

---

### 3.4 ADX (Average Directional Index)（平均趋向指标）**[趋势] [多周期-必须]**

**作用：** 衡量趋势强度的标准指标，帮助识别趋势市/震荡市，决定策略类型。

**计算公式：**
```
# 步骤1：计算方向运动
+DM_t = H_t - H_{t-1}  if H_t - H_{t-1} > L_{t-1} - L_t else 0
-DM_t = L_{t-1} - L_t  if L_{t-1} - L_t > H_t - H_{t-1} else 0

# 步骤2：平滑并计算方向指标
+DI_t = (EMA_n(+DM_t) / EMA_n(TR_t)) × 100
-DI_t = (EMA_n(-DM_t) / EMA_n(TR_t)) × 100

# 步骤3：计算ADX
DX_t = |+DI_t - -DI_t| / (+DI_t + -DI_t) × 100
ADX_t = EMA_n(DX_t)
```

**参数：** n = 14

**多周期配置：**
- **15分钟**：短线趋势判断
- **30分钟**：日内策略选择 ⭐⭐
- **60分钟**：大级别趋势强度 ⭐⭐
- **120分钟**：跨时段趋势判断

**使用说明：**
- ADX < 20：弱趋势/震荡市（均值回归策略）
- ADX 20-25：趋势形成中
- ADX > 25：强趋势市（趋势跟踪策略）⭐
- ADX > 40：极强趋势
- +DI > -DI：上升趋势主导
- -DI > +DI：下降趋势主导

---

### 3.5 ROC (Rate of Change)（变化率）**[多周期-建议]**

**作用：** 简单直接的动量指标，衡量价格变化速度，识别超买超卖和动量发散。

**计算公式：**
```
ROC_t = (C_t - C_{t-n}) / C_{t-n} × 100%
```

**参数：** n = 10（短期）, n = 20（中期）

**多周期配置：**
- **15分钟**：短期动量
- **30分钟**：日内动量 ⭐
- **60分钟**：中期动量

**使用说明：**
- ROC > 0：上涨动量
- ROC < 0：下跌动量
- ROC极值：超买超卖
- 多周期ROC同向 = 强动量

---

## 4. 趋势与均线因子 (Trend & Moving Average Factors)

趋势因子是量化交易的基石，用于识别和跟踪价格的主要方向。

---

### 4.1 SMA (Simple Moving Average)（简单移动平均）**[趋势] [多周期-必须]**

**作用：** 最基础的趋势指标，平滑价格噪音，识别趋势方向，提供动态支撑阻力。

**计算公式：**
```
SMA_n(C_t) = (1/n) × Σ(C_i),  i ∈ [t-n+1, t]
```

**常用参数：**
- n = 5：超短期趋势
- n = 10：短期趋势
- n = 20：短中期趋势
- n = 50：中期趋势
- n = 200：长期趋势

**多周期配置（必须）：**
- **5分钟**：超短线趋势，参数：SMA(5, 10, 20)
- **15分钟**：短线趋势，参数：SMA(5, 10, 20) ⭐
- **30分钟**：日内主趋势，参数：SMA(10, 20, 50) ⭐⭐
- **60分钟**：大趋势方向，参数：SMA(10, 20, 50) ⭐⭐
- **120分钟**：跨时段趋势，参数：SMA(20, 50, 100)

**使用说明：**
- 价格 > MA：上升趋势
- 价格 < MA：下降趋势
- MA向上：趋势向上
- MA向下：趋势向下
- 多周期MA排列一致 = 强趋势

---

### 4.2 EMA (Exponential Moving Average)（指数移动平均）**[趋势] [多周期-必须]**

**作用：** 对近期价格赋予更高权重，反应更灵敏，适合快速市场和短线交易。

**计算公式：**
```
α = 2 / (n + 1)
EMA_t = α × C_t + (1 - α) × EMA_{t-1}
```

**常用参数：**
- n = 12, 26：MACD计算
- n = 20：短期趋势
- n = 50：中期趋势

**多周期配置（必须）：**
- **5分钟**：快速反应，参数：EMA(5, 10, 20)
- **15分钟**：短线操作，参数：EMA(5, 10, 20) ⭐
- **30分钟**：日内核心，参数：EMA(10, 20, 50) ⭐⭐
- **60分钟**：主趋势，参数：EMA(20, 50) ⭐⭐
- **120分钟**：大级别，参数：EMA(20, 50, 100)

**使用说明：**
- 比SMA更快响应价格变化
- 更适合趋势跟踪
- 多周期EMA系统是核心趋势工具

---

### 4.3 MA_Cross（均线交叉）**[趋势] [多周期-必须]**

**作用：** 经典的趋势转折信号，金叉死叉是最广为人知的交易信号。

**计算公式：**
```
MA_Cross_t = MA_short(C_t) - MA_long(C_t)
```

**常用组合：**
- 5日/10日：超短期
- 5日/20日：短期
- 10日/30日：中短期
- 20日/60日：中期
- 50日/200日：长期（黄金交叉/死亡交叉）

**多周期配置（必须）：**
- **5分钟**：MA(5) × MA(10) - 快速信号
- **15分钟**：MA(5) × MA(20) - 短线主信号 ⭐
- **30分钟**：MA(10) × MA(30) - 日内主信号 ⭐⭐
- **60分钟**：MA(20) × MA(50) - 大趋势确认 ⭐⭐

**使用说明：**
- 金叉：短期均线上穿长期均线（买入）
- 死叉：短期均线下穿长期均线（卖出）
- 配合成交量确认：放量金叉更可靠
- 多周期共振金叉 = 强烈买入信号

---

### 4.4 Price_MA_Distance（价格偏离均线）**[多周期-建议]**

**作用：** 衡量价格偏离趋势的程度，识别超买超卖和均值回归机会。

**计算公式：**
```
Price_MA_Dist_t = (C_t - MA_n(C_t)) / MA_n(C_t) × 100%
```

**参数：** n = 20

**多周期配置：**
- **15分钟**：短线偏离
- **30分钟**：日内主要参考 ⭐
- **60分钟**：大级别偏离

**使用说明：**
- |Distance| > 5%：显著偏离
- |Distance| > 10%：极端偏离
- 趋势市偏离度可能持续较大

---

### 4.5 MA_Slope（均线斜率）**[趋势] [多周期-建议]**

**作用：** 量化趋势的方向和强度，判断趋势的加速或减速。

**计算公式：**
```
MA_Slope_t = (MA_n(C_t) - MA_n(C_{t-m})) / MA_n(C_{t-m}) × 100%
```

**参数：** n = 20, m = 5

**多周期配置：**
- **30分钟**：日内趋势强度 ⭐
- **60分钟**：大趋势强度

**使用说明：**
- Slope > 0：上升趋势
- Slope < 0：下降趋势
- |Slope|增大：趋势加速
- |Slope|减小：趋势减速

---

## 5. 市场强度因子 (Market Strength Factors)

市场强度因子评估多空力量对比和资金流向。

---

### 5.1 CMF (Chaikin Money Flow)（蔡金资金流）**[趋势] [多周期-建议]**

**作用：** 结合价格位置和成交量的资金流指标，判断买卖压力强度。

**计算公式：**
```
MF_Multiplier_t = ((C_t - L_t) - (H_t - C_t)) / (H_t - L_t)
MF_Volume_t = MF_Multiplier_t × V_t

CMF_t = Σ(MF_Volume_i) / Σ(V_i),  i ∈ [t-n+1, t]
```

**参数：** n = 20

**多周期配置：**
- **30分钟**：日内资金流 ⭐
- **60分钟**：主要资金流向

**使用说明：**
- CMF > 0：买盘主导
- CMF < 0：卖盘主导
- CMF > 0.25：强烈买压
- CMF < -0.25：强烈卖压

---

### 5.2 Force_Index（力量指数）**[单周期]**

**作用：** 综合价格变化和成交量的力量指标，识别趋势的真实强度。

**计算公式：**
```
Force_Index_t = (C_t - C_{t-1}) × V_t
Force_Index_EMA_t = EMA_13(Force_Index_t)
```

**使用说明：**
- Force_Index > 0：买方力量强
- Force_Index < 0：卖方力量强
- 使用1分钟或5分钟数据计算即可

---

## 6. 价格形态因子 (Price Pattern Factors)

价格形态因子从K线结构中提取信息，识别市场情绪和可能的转折。

---

### 6.1 Price_Range_Position（价格区间位置）**[单周期]**

**作用：** 收盘价在当日高低价区间的位置，反映日内多空力量对比。

**计算公式：**
```
Price_Range_Pos_t = (C_t - L_t) / (H_t - L_t)
```

**使用说明：**
- 接近1：收在最高点，强势
- 接近0：收在最低点，弱势
- 接近0.5：多空平衡
- 使用当前周期数据即可

---

### 6.2 Candle_Body_Ratio（实体比例）**[单周期]**

**作用：** K线实体相对影线的比例，判断多空确定性程度。

**计算公式：**
```
Candle_Body_Ratio_t = |C_t - O_t| / (H_t - L_t)
```

**使用说明：**
- 接近1：大实体，方向确定性强
- 接近0：十字星，犹豫不决
- 使用当前周期数据即可

---

## 7. 统计因子 (Statistical Factors)

统计因子从概率角度评估价格状态。

---

### 7.1 Z_Score（标准分数）**[多周期-建议]**

**作用：** 价格相对历史均值的标准差倍数，识别极端价格和均值回归机会。

**计算公式：**
```
Z_Score_t = (C_t - MA_n(C_t)) / Std_n(C_t)
```

**参数：** n = 20

**多周期配置：**
- **30分钟**：日内极值
- **60分钟**：主要参考 ⭐
- **120分钟**：大级别极值

**使用说明：**
- |Z| > 2：价格异常偏离
- |Z| > 3：极端偏离
- 用于均值回归策略

---

### 7.2 Percentile_Rank（百分位排名）**[多周期-建议]**

**作用：** 当前价格在历史分布中的相对位置。

**计算公式：**
```
Percentile_Rank_t = Rank(C_t in [C_{t-n+1}...C_t]) / n × 100%
```

**参数：** n = 100

**多周期配置：**
- **60分钟**：主要参考
- **120分钟**：长期位置

**使用说明：**
- > 90%：接近历史高位
- < 10%：接近历史低位

---

## 8. 趋势因子总结

### 8.1 核心趋势因子（多周期必须）

以下因子**必须**计算多个时间周期用于趋势判断：

| 因子 | 类型 | 多周期要求 | 推荐周期 | 优先级 |
|------|------|-----------|----------|--------|
| **MACD** | 动量趋势 | 必须 | 15m, 30m, 60m, 120m | ⭐⭐⭐⭐⭐ |
| **ADX** | 趋势强度 | 必须 | 15m, 30m, 60m, 120m | ⭐⭐⭐⭐⭐ |
| **EMA** | 趋势方向 | 必须 | 5m, 15m, 30m, 60m, 120m | ⭐⭐⭐⭐⭐ |
| **SMA** | 趋势方向 | 必须 | 5m, 15m, 30m, 60m, 120m | ⭐⭐⭐⭐⭐ |
| **MA_Cross** | 趋势转折 | 必须 | 5m, 15m, 30m, 60m | ⭐⭐⭐⭐⭐ |
| **MA_Slope** | 趋势强度 | 建议 | 30m, 60m | ⭐⭐⭐⭐ |
| **OBV** | 资金流趋势 | 必须 | 15m, 30m, 60m | ⭐⭐⭐⭐ |
| **VWAP** | 日内趋势 | 单周期 | 日内累计 | ⭐⭐⭐⭐ |
| **CMF** | 资金流趋势 | 建议 | 30m, 60m | ⭐⭐⭐ |

---

### 8.2 趋势确认因子（多周期建议）

用于验证趋势真实性的因子：

| 因子 | 验证作用 | 多周期配置 |
|------|----------|-----------|
| **OBV** | 成交量确认趋势 | 15m, 30m, 60m |
| **CMF** | 资金流确认趋势 | 30m, 60m |
| **Volume_Ratio** | 放量确认突破 | 5m, 15m, 30m, 60m |
| **VWAP** | 日内趋势基准 | 日内累计 |

---

### 8.3 趋势强度判断因子

量化趋势力度的因子：

| 因子 | 强度衡量方式 | 多周期配置 |
|------|-------------|-----------|
| **ADX** | 直接量化趋势强度 | 15m, 30m, 60m, 120m ⭐ |
| **ATR** | 波动率扩大 = 趋势加强 | 5m, 15m, 30m, 60m, 120m |
| **MA_Slope** | 均线斜率陡峭程度 | 30m, 60m |
| **MACD_Histogram** | 动量强弱 | 15m, 30m, 60m, 120m |

---

### 8.4 趋势反转预警因子

识别趋势可能结束的信号：

| 因子 | 反转信号 | 多周期配置 |
|------|----------|-----------|
| **RSI** | 极值区域（>70或<30） | 5m, 15m, 30m, 60m |
| **MACD** | 背离、Histogram收敛 | 15m, 30m, 60m, 120m |
| **Stochastic** | 超买超卖 | 5m, 15m, 30m |
| **ADX** | ADX下降 = 趋势减弱 | 15m, 30m, 60m, 120m |
| **Volume_Ratio** | 成交量萎缩 | 5m, 15m, 30m, 60m |

---

## 9. 多周期因子配置总览

### 9.1 必须多周期的因子（Top 10）

| 排名 | 因子名称 | 推荐周期 | 核心周期 | 优先级 |
|------|----------|----------|----------|--------|
| 1 | **EMA/SMA** | 5m, 15m, 30m, 60m, 120m | 30m, 60m | ⭐⭐⭐⭐⭐ |
| 2 | **MACD** | 15m, 30m, 60m, 120m | 30m, 60m | ⭐⭐⭐⭐⭐ |
| 3 | **ADX** | 15m, 30m, 60m, 120m | 30m, 60m | ⭐⭐⭐⭐⭐ |
| 4 | **ATR** | 5m, 15m, 30m, 60m, 120m | 30m, 60m | ⭐⭐⭐⭐⭐ |
| 5 | **RSI** | 5m, 15m, 30m, 60m | 15m, 30m, 60m | ⭐⭐⭐⭐ |
| 6 | **MA_Cross** | 5m, 15m, 30m, 60m | 15m, 30m, 60m | ⭐⭐⭐⭐ |
| 7 | **Bollinger Bands** | 15m, 30m, 60m | 30m, 60m | ⭐⭐⭐⭐ |
| 8 | **Volume_Ratio** | 5m, 15m, 30m, 60m | 15m, 30m, 60m | ⭐⭐⭐⭐ |
| 9 | **OBV** | 15m, 30m, 60m | 30m, 60m | ⭐⭐⭐⭐ |
| 10 | **ROC** | 15m, 30m, 60m | 30m, 60m | ⭐⭐⭐ |

---

### 9.2 建议多周期的因子

| 因子名称 | 推荐周期 | 说明 |
|----------|----------|------|
| **Stochastic** | 5m, 15m, 30m | 短周期适用 |
| **CMF** | 30m, 60m | 资金流判断 |
| **Price_MA_Distance** | 15m, 30m, 60m | 偏离度监控 |
| **MA_Slope** | 30m, 60m | 趋势强度 |
| **Historical_Volatility** | 30m, 60m, 120m | 波动率分析 |
| **Z_Score** | 30m, 60m, 120m | 统计极值 |
| **Percentile_Rank** | 60m, 120m | 历史位置 |

---

### 9.3 单周期即可的因子

以下因子使用单一周期（通常是1分钟或当前交易周期）即可：

| 因子名称 | 说明 |
|----------|------|
| **VWAP** | 日内累计，特殊计算方式 |
| **VWAP_Distance** | 基于VWAP计算 |
| **Force_Index** | 短期力量指标 |
| **Price_Range_Position** | 当前K线特征 |
| **Candle_Body_Ratio** | 当前K线特征 |

---

## 10. 周期选择指南

### 10.1 根据交易风格选择核心周期

| 交易风格 | 核心周期 | 参考周期 | 持仓时间 |
|----------|----------|----------|----------|
| **超短线（Scalping）** | 5分钟 | 1分钟、15分钟 | 5-30分钟 |
| **短线（Day Trading）** | 15-30分钟 | 5分钟、60分钟 | 1-6小时 |
| **日内波段** | 30-60分钟 | 15分钟、120分钟 | 数小时-1天 |
| **隔夜持仓** | 60-120分钟 | 30分钟、240分钟 | 1-数天 |

---

### 10.2 周期作用说明

| 周期 | 主要用途 | 适用场景 | 重要性 |
|------|----------|----------|--------|
| **5分钟** | 超短线入场、快速反应 | 超短线交易、止损设置 | ⭐⭐⭐ |
| **15分钟** | 短线信号、日内操作 | 日内短线、快进快出 | ⭐⭐⭐⭐ |
| **30分钟** | 日内主趋势、核心信号 | 日内主要交易周期 | ⭐⭐⭐⭐⭐ |
| **60分钟** | 大趋势判断、方向确认 | 所有交易风格参考 | ⭐⭐⭐⭐⭐ |
| **120分钟** | 跨时段趋势、大级别 | 隔夜持仓、趋势背景 | ⭐⭐⭐⭐ |
| **240分钟** | 大周期结构 | 长线趋势背景 | ⭐⭐⭐ |

---

### 10.3 最小配置建议

如果资源有限，至少计算以下周期：

**最小配置（3个周期）：**
- **30分钟** - 日内核心 ⭐⭐⭐
- **60分钟** - 大趋势判断 ⭐⭐⭐
- **15分钟** - 入场时机 ⭐⭐

**标准配置（5个周期）：**
- 5分钟、15分钟、30分钟、60分钟、120分钟

**完整配置（6个周期）：**
- 5分钟、15分钟、30分钟、60分钟、120分钟、240分钟

---

## 11. 实战要点

### 11.1 多周期使用原则

1. **大周期定方向，小周期找入场**
   - 60分钟/120分钟确定趋势方向
   - 15分钟/30分钟确认信号
   - 5分钟寻找精确入场点

2. **多周期共振信号胜率更高**
   - 三个以上周期信号一致时采取行动
   - 单一周期信号谨慎对待

3. **根据持仓时间选择主要参考周期**
   - 持仓30分钟 → 主看5分钟因子
   - 持仓2-4小时 → 主看15-30分钟因子
   - 持仓半天以上 → 主看60分钟因子

4. **周期越大，信号越可靠但滞后**
   - 大周期信号可靠性高，但反应慢
   - 小周期信号灵敏，但容易产生噪音

---

### 11.2 数据对齐注意事项

**关键原则：避免未来函数**

```
错误做法：直接使用高周期最新值
正确做法：使用forward fill方式将高周期数据回填到低周期
```

**数据回填方法：**
- 将高周期因子值向前填充（ffill）到1分钟数据
- 确保在t时刻，只能看到t时刻及之前的高周期数据
- 不能使用未来的高周期bar数据

---

### 11.3 计算效率建议

1. **批量重采样**
   - 一次性重采样到所有需要的周期
   - 在各周期上计算所有因子
   - 最后统一回填到1分钟

2. **缓存重采样结果**
   - 避免重复重采样
   - 实盘时使用增量更新

3. **只保留必要因子**
   - 不是所有因子都需要所有周期
   - 根据策略需求选择性计算

---

## 附录：快速查询表

### A. 因子多周期配置总表

| 因子 | 多周期要求 | 最小配置 | 标准配置 | 优先级 |
|------|-----------|---------|----------|--------|
| EMA/SMA | 必须 | 30m, 60m | 5m, 15m, 30m, 60m, 120m | ⭐⭐⭐⭐⭐ |
| MACD | 必须 | 30m, 60m | 15m, 30m, 60m, 120m | ⭐⭐⭐⭐⭐ |
| ADX | 必须 | 30m, 60m | 15m, 30m, 60m, 120m | ⭐⭐⭐⭐⭐ |
| ATR | 必须 | 30m, 60m | 5m, 15m, 30m, 60m, 120m | ⭐⭐⭐⭐⭐ |
| RSI | 必须 | 30m, 60m | 5m, 15m, 30m, 60m | ⭐⭐⭐⭐ |
| Bollinger | 必须 | 30m, 60m | 15m, 30m, 60m | ⭐⭐⭐⭐ |
| Volume_Ratio | 必须 | 30m, 60m | 5m, 15m, 30m, 60m | ⭐⭐⭐⭐ |
| OBV | 必须 | 30m, 60m | 15m, 30m, 60m | ⭐⭐⭐⭐ |
| MA_Cross | 必须 | 30m, 60m | 5m, 15m, 30m, 60m | ⭐⭐⭐⭐ |
| ROC | 建议 | 30m, 60m | 15m, 30m, 60m | ⭐⭐⭐ |
| Stochastic | 建议 | 15m, 30m | 5m, 15m, 30m | ⭐⭐⭐ |
| CMF | 建议 | 30m, 60m | 30m, 60m | ⭐⭐⭐ |
| Price_MA_Dist | 建议 | 30m, 60m | 15m, 30m, 60m | ⭐⭐⭐ |
| MA_Slope | 建议 | 30m, 60m | 30m, 60m | ⭐⭐⭐ |
| HV | 建议 | 60m | 30m, 60m, 120m | ⭐⭐ |
| Z_Score | 建议 | 60m | 30m, 60m, 120m | ⭐⭐ |
| VWAP | 单周期 | 日内 | 日内累计 | ⭐⭐⭐⭐ |
| Force_Index | 单周期 | 1m/5m | 1m/5m | ⭐⭐ |

---

### B. 参数速查表

| 因子 | 经典参数 | 适用周期 |
|------|----------|----------|
| RSI | 14 | 所有周期 |
| MACD | 12/26/9 | 所有周期 |
| ADX | 14 | 所有周期 |
| ATR | 14 | 所有周期 |
| Bollinger | 20, 2σ | 所有周期 |
| Stochastic | 14, 3 | 短周期为主 |
| Volume_Ratio | 20 | 所有周期 |
| CMF | 20 | 所有周期 |
| ROC | 10-20 | 所有周期 |

---

### C. 超买超卖阈值

| 指标 | 超买 | 超卖 | 极端超买 | 极端超卖 |
|------|------|------|----------|----------|
| RSI | 70 | 30 | 80 | 20 |
| Stochastic %K | 80 | 20 | 90 | 10 |
| Bollinger %B | > 1 | < 0 | > 1.2 | < -0.2 |
| Z-Score | > 2 | < -2 | > 3 | < -3 |

---

### D. ADX趋势强度判断

| ADX值 | 市场状态 | 策略选择 |
|-------|----------|----------|
| < 20 | 无趋势/震荡 | 均值回归 |
| 20-25 | 趋势形成中 | 谨慎跟踪 |
| 25-40 | 强趋势 | 趋势跟踪 ⭐ |
| > 40 | 极强趋势 | 积极跟踪 |

---

**文档版本：** v4.0
**更新日期：** 2026-01-07
**适用范围：** 1分钟OHLCV数据，多周期因子计算
**因子数量：** 25个经典因子
**趋势因子：** 8个核心趋势因子（已标注）
**多周期标注：** 完整（必须/建议/单周期）

---

**使用建议：**
1. 所有标注【多周期-必须】的因子都应该计算多个时间周期
2. 最小配置至少包含30分钟和60分钟两个周期
3. 标准配置建议使用5个周期：5m, 15m, 30m, 60m, 120m
4. 根据自己的交易风格选择核心周期
5. 优先实现优先级为⭐⭐⭐⭐⭐的因子
